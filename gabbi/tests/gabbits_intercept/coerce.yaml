defaults:
  request_headers:
      content-type: application/json
  verbose: True

tests:
- name: post data
  POST: /
  data:
      one_string: "1"
      one_int: 1
      one_float: 1.1
  response_json_paths:
      $.one_string: "1"
      $.one_int: 1
      $.one_float: 1.1
  response_strings:
      - '"one_string": "1"'
      - '"one_int": 1'
      - '"one_float": 1.1'

- name: use data
  desc: data will be coerced because templates in use
  POST: /
  data:
      one_string: $RESPONSE['$.one_string']
      one_int: $RESPONSE['$.one_int']
      one_float: $RESPONSE['$.one_float']
  response_json_paths:
      $.one_string: 1
      $.one_int: 1
      $.one_float: 1.1
  response_strings:
      - '"one_string": 1'
      - '"one_int": 1'
      - '"one_float": 1.1'

- name: from environ
  POST: /
  data:
      one_environ: $ENVIRON['ONE']
  response_json_paths:
      $.one_environ: 1
  response_strings:
      - '"one_environ": 1'

- name: with list
  POST: /
  data:
      - $ENVIRON['ONE']
      - 2
      - "3"
  response_json_paths:
      $[0]: 1
      $[1]: 2
      $[2]: 3
  response_strings:
      - '[1, 2, 3]'

- name: object with list
  desc: without recursive handling no coersion
  POST: /
  data:
      collection:
          - alpha: $ENVIRON['ONE']
            beta: max
          - alpha: 2
            beta: climb
  response_json_paths:
      $.collection[0].alpha: 1
      $.collection[0].beta: max
      $.collection[1].alpha: 2
      $.collection[1].beta: climb
  response_strings:
      - "alpha": 1
      - "beta": "max"

- name: post to httpbin
  POST: /
  data:
    a: 1
    b: 1.0
    c: [1,2,3]
    d: true
    e: false
    f:
      key: val
    g: null
    h:
      key:
        less_key: [1.0, 2.0, 3.0]
        more_key: 1
  response_json_paths:
    a: 1
    b: 1.0
    c: [1,2,3]
    d: true
    e: false
    f:
      key: val
    g: null
    h:
      key:
        less_key: [1.0, 2.0, 3.0]
        more_key: 1
  status: 200

- name: Check posted data
  POST: /
  data:
    a: $RESPONSE['$.a']
    b: $RESPONSE['$.b']
    c: $RESPONSE['$.c']
    d: $RESPONSE['$.d']
    e: $RESPONSE['$.e']
    f: $RESPONSE['$.f']
    g: $RESPONSE['$.g']
    h: $RESPONSE['$.h']
    response_json_paths:
      a: 1
    b: 1.0
    c: [1,2,3]
    d: true
    e: false
    f:
      key: val
    g: null
    h:
      key:
        less_key: [1.0, 2.0, 3.0]
    more_key: 1
    status: 200

    #- name: Post again and check the results
    #POST: /
    #data:
    #a: $HISTORY['post to httpbin'].$RESPONSE['$.a']
    #b: $HISTORY['post to httpbin'].$RESPONSE['$.b']
    #c: $HISTORY['post to httpbin'].$RESPONSE['$.c']
    #d: $HISTORY['post to httpbin'].$RESPONSE['$.d']
    #e: $HISTORY['post to httpbin'].$RESPONSE['$.e']
    #f: $HISTORY['post to httpbin'].$RESPONSE['$.f']
    #g: $HISTORY['post to httpbin'].$RESPONSE['$.g']
    #h: $HISTORY['post to httpbin'].$RESPONSE['$.h']
    #response_json_paths:
    #a: $ENVIRON['A']
    #b: $ENVIRON['B']
    #c: $ENVIRON['C']
    #d: $ENVIRON['D']
    #e: $ENVIRON['E']
    #f:
    #key: $ENVIRON['F']
    #g: $ENVIRON['G']
    #h:
    #key:
    #less_key:
    #- $ENVIRON['P']
    #- $ENVIRON['Q']
    #- $ENVIRON['R']
    #more_key: $ENVIRON['S']
    #status: 200

    #- name: Post again and check the results (reversed)
    #POST: /
    #data:
    #a: $ENVIRON['A']
    #b: $ENVIRON['B']
    #c: $ENVIRON['C']
    #d: $ENVIRON['D']
    #e: $ENVIRON['E']
    #f:
    #key: $ENVIRON['F']
    #g: $ENVIRON['G']
    #h:
    #key:
    #less_key:
    #- $ENVIRON['P']
    #- $ENVIRON['Q']
    #- $ENVIRON['R']
    #more_key: $ENVIRON['S']
    #response_json_paths:
    #a: $HISTORY['Check posted data'].$RESPONSE['$.a']
    #b: $HISTORY['Check posted data'].$RESPONSE['$.b']
    #c: $HISTORY['Check posted data'].$RESPONSE['$.c']
    #d: $HISTORY['Check posted data'].$RESPONSE['$.d']
    #e: $HISTORY['Check posted data'].$RESPONSE['$.e']
    #f: $HISTORY['Check posted data'].$RESPONSE['$.f']
    #g: $HISTORY['Check posted data'].$RESPONSE['$.g']
    #h: $HISTORY['Check posted data'].$RESPONSE['$.h']
    #status: 200
